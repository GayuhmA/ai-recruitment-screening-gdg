# Railway Deployment Guide

## ğŸš‚ Deploy Backend API ke Railway

### Prerequisites
- GitHub account (untuk connect repo)
- Railway account (free tier)
- Gemini API key

---

## ğŸ“ Step 1: Setup Railway Account

1. Buka: https://railway.app
2. Sign up dengan GitHub
3. Klik "New Project"

---

## ğŸ”§ Step 2: Deploy dari GitHub

### Option A: Deploy via Dashboard (Recommended)

1. **New Project** â†’ **Deploy from GitHub repo**
2. Pilih repository: `GayuhmA/ai-recruitment-screening-gdg`
3. Railway auto-detect Dockerfile

### Option B: Deploy via CLI

```powershell
# Install Railway CLI
npm install -g @railway/cli

# Login
railway login

# Link project
railway link

# Deploy
railway up
```

---

## ğŸ—„ï¸ Step 3: Add Database & Services

Railway auto-provision services:

1. **PostgreSQL:**
   - Klik "New Service" â†’ "Database" â†’ "PostgreSQL"
   - Railway auto-generate `DATABASE_URL`

2. **Redis:**
   - Klik "New Service" â†’ "Database" â†’ "Redis"
   - Railway auto-generate `REDIS_URL`

**âš ï¸ NOTE:** Railway free tier tidak support MinIO. Gunakan alternatif:
- **AWS S3** (free tier 5GB)
- **Cloudflare R2** (10GB free)
- **Supabase Storage** (1GB free)

---

## âš™ï¸ Step 4: Configure Environment Variables

Di Railway Dashboard â†’ Variables, tambahkan:

### Required Variables:

```env
NODE_ENV=production
PORT=3000
APP_PORT=3000

# Database (auto-generated by Railway)
DATABASE_URL=${{Postgres.DATABASE_URL}}

# Redis (auto-generated by Railway)
REDIS_URL=${{Redis.REDIS_URL}}

# JWT Secret
JWT_SECRET=your_generated_secret_here

# Gemini API
GEMINI_API_KEY=AIzaSy...your_key_here

# S3/Storage (pilih salah satu)
# Option 1: AWS S3
S3_ENDPOINT=https://s3.amazonaws.com
S3_ACCESS_KEY_ID=your_aws_access_key
S3_SECRET_ACCESS_KEY=your_aws_secret_key
S3_BUCKET=your-bucket-name
S3_REGION=us-east-1

# Option 2: Cloudflare R2
S3_ENDPOINT=https://your-account-id.r2.cloudflarestorage.com
S3_ACCESS_KEY_ID=your_r2_access_key
S3_SECRET_ACCESS_KEY=your_r2_secret_key
S3_BUCKET=cv-docs
S3_REGION=auto
S3_FORCE_PATH_STYLE=true

# Frontend URL (update after deploy frontend)
FRONTEND_URL=https://your-frontend.vercel.app
```

### Generate JWT Secret:
```powershell
# PowerShell
-join ((65..90) + (97..122) + (48..57) | Get-Random -Count 32 | % {[char]$_})
```

---

## ğŸš€ Step 5: Deploy

### Auto Deploy (GitHub)
- Railway auto-deploy setiap push ke branch `main` atau `dev`
- Enable di: Settings â†’ Deploys â†’ "Watch Paths"

### Manual Deploy
```powershell
railway up
```

---

## ğŸŒ Step 6: Get Public URL

1. Railway Dashboard â†’ Settings â†’ "Generate Domain"
2. Copy domain: `your-app.railway.app`
3. Test: `https://your-app.railway.app/health`

---

## ğŸ“± Step 7: Update Frontend

Update frontend environment:

```env
# Next.js
NEXT_PUBLIC_API_URL=https://your-app.railway.app

# React/Vite
VITE_API_URL=https://your-app.railway.app
```

Deploy frontend ke Vercel:
```powershell
cd apps/web
vercel deploy --prod
```

---

## ğŸ” Monitoring & Logs

Railway Dashboard â†’ Deployments â†’ View Logs

```powershell
# Via CLI
railway logs
```

---

## ğŸ’° Railway Free Tier Limits

- âœ… 512 MB RAM
- âœ… 1 GB Disk
- âœ… $5 credit/month (â‰ˆ 500 jam)
- âœ… Unlimited deploys
- âŒ No MinIO (gunakan S3/R2/Supabase)

---

## ğŸ†˜ Troubleshooting

### Build Failed?
```powershell
# Check build logs
railway logs --deployment

# Test build locally
docker build -f apps/api/Dockerfile -t test-api .
```

### Database Connection Error?
- Pastikan `DATABASE_URL` menggunakan internal URL Railway
- Format: `postgresql://user:pass@postgres.railway.internal:5432/db`

### Port Issues?
- Railway auto-assign `PORT` env variable
- Pastikan app listen ke `process.env.PORT || 3000`

---

## ğŸ” Security Checklist

- [ ] JWT_SECRET changed (jangan gunakan contoh!)
- [ ] GEMINI_API_KEY valid
- [ ] S3 credentials secure
- [ ] FRONTEND_URL updated
- [ ] Railway secrets (jangan commit!)

---

## ğŸ“Š Architecture on Railway

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTPS
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Railway     â”‚
â”‚  (Public)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Container   â”‚  â—„â”€â”
â””â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
   â”‚   â”‚               â”‚
   â–¼   â–¼               â”‚
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ PG â”‚ Redisâ”‚          â”‚ Railway Internal Network
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜          â”‚
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  S3/R2       â”‚  â—„â”€â”€â”€â”€â”˜
â”‚  (External)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Quick Deploy Commands

```powershell
# 1. Commit & push
git add .
git commit -m "feat: Railway deployment config"
git push origin main

# 2. Railway auto-deploy (jika sudah connect GitHub)

# 3. Atau manual deploy
railway up

# 4. Check status
railway status

# 5. Open in browser
railway open
```

---

**Good luck! ğŸš‚**
